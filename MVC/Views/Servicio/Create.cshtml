@model MVC.Models.ServicioViewModel

<h2>Alta Servicio</h2>

@if (ViewBag.Error != null)
    {
        <div class="alert alert-danger" role="alert">
            @ViewBag.Error
        </div>
    }
@if (ViewData["ErrorMessage"] != null)
{
    <div class="alert alert-danger">
        @ViewData["ErrorMessage"]
    </div>
}

@using (Html.BeginForm("Create", "Servicio", FormMethod.Post))
{
    <div class="form-group">
        <label asp-for="Fecha" class="control-label"></label>
        <input type="date" id="fechaInput" asp-for="Fecha" class="form-control" readonly />
        <span asp-validation-for="Fecha" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label asp-for="VehiculoId" class="control-label"></label>
        <select asp-for="VehiculoId" asp-items="@Model.Vehiculos.Select(v => new SelectListItem { Value = v.Id.ToString(), Text = v.Matricula })" class="form-control">
            <option value="">-- Seleccione un Vehículo --</option>
        </select>
        <span asp-validation-for="VehiculoId" class="text-danger"></span>
    </div>
    <div class="form-group">
        <label asp-for="Km" class="control-label"></label>
        <input asp-for="Km" class="form-control" />
        <span asp-validation-for="Km" class="text-danger"></span>
    </div>

    <!-- Add material selection and quantities dynamically -->
    <h4>Mantenimientos</h4>
    <table id="mantenimientosTable">
        <thead>
            <tr>
                @*<th>Repuesto</th>
                <th>Cantidad</th>
                <th>Precio</th>*@
            </tr>
        </thead>
        <tbody id="mantenimientosTableBody">
            <!-- Dynamic rows will be added here -->
        </tbody>
    </table>

    <button type="button" id="btnAddMantenimiento">Agregar Mantenimiento</button>

    <div class="form-group">
        <input type="submit" value="Guardar" class="btn btn-primary" />
    </div>
}

@section Scripts {
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Get current date and format it as yyyy-mm-dd
            var currentDate = new Date().toISOString().split('T')[0];
            document.getElementById("fechaInput").value = currentDate;

            // Track the index for dynamic elements
            var mantenimientoIndex = 0;

            // Add labels for Repuesto, Cantidad, and Precio outside the loop
            var labelRow = document.createElement("tr");

            // Handle click event for the "Add Repuesto" button
            document.getElementById("btnAddMantenimiento").addEventListener("click", function () {
                var newRow = document.createElement("tr");

                if (mantenimientoIndex < 1) {
                    labelRow.innerHTML = `<td><label for="mantenimiento" class="control-label">Mantenimiento</label></td>
                                          <td><label for="siniestro" class="control-label">Siniestro</label></td>
                                          
                                          <td></td>`;  // Empty cell for delete button
                    document.getElementById("mantenimientosTableBody").appendChild(labelRow);
                }

                newRow.innerHTML = `<td>
                                        <select name="MantenimientosId[${mantenimientoIndex}]" class="form-control">
                                            @foreach (var mantenimiento in Model.Mantenimientos)
                                            {
                                                <option value="@mantenimiento.Id">@mantenimiento.Tarea</option>
                                            }
                                        </select>
                                     </td>
                                     <td>
                                        
                                        <input type="checkbox" name="Siniestro[${mantenimientoIndex}]" value="true" />
                                    </td>

                                     <td>
                                        <button type="button" class="btn btn-danger remove-mantenimiento">Eliminar</button>
                                     </td>`;
                document.getElementById("mantenimientosTableBody").appendChild(newRow);

                // Add event listener to the new remove button
                newRow.querySelector('.remove-mantenimiento').addEventListener('click', function () {
                    newRow.remove();
                });

                mantenimientoIndex++;
            });
        });
    </script>
}
